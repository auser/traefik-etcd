<!DOCTYPE html>
<html lang="en" id="oranda" class="dark axo">
  <head>
    <title>traefikctl</title>
    
      <meta property="og:url" content="https://github.com/auser/traefikctl" />
    
    
      <link rel="icon" href="/traefikctl/favicon.ico" />
    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
      <meta name="description" content="A CLI for managing traefik with etcd (and more)" />
      <meta property="og:description" content="A CLI for managing traefik with etcd (and more)" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="traefikctl" />
    
    
    
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()" />
    <link rel="stylesheet" href="/traefikctl/oranda-v0.6.1.css" />
    
    
  </head>
  <body>
    <div class="container">
      <div class="page-body">
        
          <div class="repo_banner">
            <a href="https://github.com/auser/traefikctl">
              <div class="github-icon" aria-hidden="true"></div>
              Check out our GitHub!
            </a>
          </div>
        

        <main>
          <header>
            
            <h1 class="title">traefikctl</h1>
            
  <nav class="nav">
    <ul>
      <li><a href="/traefikctl/">Home</a></li>

      

      
        <li><a href="/traefikctl/artifacts/">Install</a></li>
      

      

      

      
        <li><a href="/traefikctl/changelog/">Changelog</a></li>
      
    </ul>
  </nav>

          </header>

          

    



<div class="artifacts" data-tag="v0.2.36">
  <div class="artifact-header target">
    <h4>Install v0.2.36</h4>
    
      <div><small class="published-date">Published on Dec  6 2024 at 21:54 UTC</small></div>
    

    <ul class="arches">
      
        <li class="arch hidden" data-arch="aarch64-apple-darwin">
          
            <ul class="tabs">
              
                
                
                <li class="install-tab" data-id="7" data-triple="aarch64-apple-darwin">
                  shell

                  
                </li>
              
                
                
                <li class="install-tab" data-id="5" data-triple="aarch64-apple-darwin">
                  tarball

                  
                </li>
              
            </ul>
          

          <ul class="contents">
            
              
              <li data-id="7" data-triple="aarch64-apple-darwin" class="install-content">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">curl</span><span style="color:#89ddff;"> --</span><span style="color:#f78c6c;">proto </span><span style="color:#89ddff;">&#39;</span><span style="color:#c3e88d;">=https</span><span style="color:#89ddff;">&#39; --</span><span style="color:#f78c6c;">tlsv1</span><span style="color:#82aaff;">.2</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">LsSf</span><span style="color:#82aaff;"> https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-installer.sh </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">sh</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="curl --proto '=https' --tlsv1.2 -LsSf https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-installer.sh | sh">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
    
    
      
    
    <a class="button primary" href="/traefikctl/traefikctl-installer.sh.txt">Source</a>
  
</div>
                

                
              </li>
            
              
              <li data-id="5" data-triple="aarch64-apple-darwin" class="install-content hidden">
                

                
                  
                  <div class="download-wrapper">
                    <a href="https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-aarch64-apple-darwin.tar.xz">
                      <button class="button primary">
                        <span>Download</span>
                        <span class="button-subtitle">traefikctl-aarch64-apple-darwin.tar.xz</span>
                      </button>
                    </a>
                  </div>
                
              </li>
            
          </ul>
        </li>
      
        <li class="arch hidden" data-arch="x86_64-apple-darwin">
          
            <ul class="tabs">
              
                
                
                <li class="install-tab" data-id="7" data-triple="x86_64-apple-darwin">
                  shell

                  
                </li>
              
                
                
                <li class="install-tab" data-id="8" data-triple="x86_64-apple-darwin">
                  tarball

                  
                </li>
              
            </ul>
          

          <ul class="contents">
            
              
              <li data-id="7" data-triple="x86_64-apple-darwin" class="install-content">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">curl</span><span style="color:#89ddff;"> --</span><span style="color:#f78c6c;">proto </span><span style="color:#89ddff;">&#39;</span><span style="color:#c3e88d;">=https</span><span style="color:#89ddff;">&#39; --</span><span style="color:#f78c6c;">tlsv1</span><span style="color:#82aaff;">.2</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">LsSf</span><span style="color:#82aaff;"> https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-installer.sh </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">sh</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="curl --proto '=https' --tlsv1.2 -LsSf https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-installer.sh | sh">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
    
    
      
    
    <a class="button primary" href="/traefikctl/traefikctl-installer.sh.txt">Source</a>
  
</div>
                

                
              </li>
            
              
              <li data-id="8" data-triple="x86_64-apple-darwin" class="install-content hidden">
                

                
                  
                  <div class="download-wrapper">
                    <a href="https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-x86_64-apple-darwin.tar.xz">
                      <button class="button primary">
                        <span>Download</span>
                        <span class="button-subtitle">traefikctl-x86_64-apple-darwin.tar.xz</span>
                      </button>
                    </a>
                  </div>
                
              </li>
            
          </ul>
        </li>
      
        <li class="arch hidden" data-arch="x86_64-pc-windows-msvc">
          
            <ul class="tabs">
              
                
                
                <li class="install-tab" data-id="9" data-triple="x86_64-pc-windows-msvc">
                  msi

                  
                </li>
              
                
                
                <li class="install-tab" data-id="6" data-triple="x86_64-pc-windows-msvc">
                  powershell

                  
                </li>
              
                
                
                <li class="install-tab" data-id="10" data-triple="x86_64-pc-windows-msvc">
                  zip

                  
                </li>
              
            </ul>
          

          <ul class="contents">
            
              
              <li data-id="9" data-triple="x86_64-pc-windows-msvc" class="install-content">
                

                
                  
                  <div class="download-wrapper">
                    <a href="https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-x86_64-pc-windows-msvc.msi">
                      <button class="button primary">
                        <span>Download</span>
                        <span class="button-subtitle">traefikctl-x86_64-pc-windows-msvc.msi</span>
                      </button>
                    </a>
                  </div>
                
              </li>
            
              
              <li data-id="6" data-triple="x86_64-pc-windows-msvc" class="install-content hidden">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">powershell</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">c </span><span style="color:#89ddff;">&quot;</span><span style="color:#c3e88d;">irm https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-installer.ps1 | iex</span><span style="color:#89ddff;">&quot;</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="powershell -c "irm https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-installer.ps1 | iex"">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
    
    
      
    
    <a class="button primary" href="/traefikctl/traefikctl-installer.ps1.txt">Source</a>
  
</div>
                

                
              </li>
            
              
              <li data-id="10" data-triple="x86_64-pc-windows-msvc" class="install-content hidden">
                

                
                  
                  <div class="download-wrapper">
                    <a href="https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-x86_64-pc-windows-msvc.zip">
                      <button class="button primary">
                        <span>Download</span>
                        <span class="button-subtitle">traefikctl-x86_64-pc-windows-msvc.zip</span>
                      </button>
                    </a>
                  </div>
                
              </li>
            
          </ul>
        </li>
      
        <li class="arch hidden" data-arch="x86_64-unknown-linux-gnu">
          
            <ul class="tabs">
              
                
                
                <li class="install-tab" data-id="7" data-triple="x86_64-unknown-linux-gnu">
                  shell

                  
                </li>
              
                
                
                <li class="install-tab" data-id="11" data-triple="x86_64-unknown-linux-gnu">
                  tarball

                  
                </li>
              
            </ul>
          

          <ul class="contents">
            
              
              <li data-id="7" data-triple="x86_64-unknown-linux-gnu" class="install-content">
                
                  
                  <div class="install-code-wrapper">
  <pre style="background-color:#263238;">
<span style="color:#82aaff;">curl</span><span style="color:#89ddff;"> --</span><span style="color:#f78c6c;">proto </span><span style="color:#89ddff;">&#39;</span><span style="color:#c3e88d;">=https</span><span style="color:#89ddff;">&#39; --</span><span style="color:#f78c6c;">tlsv1</span><span style="color:#82aaff;">.2</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">LsSf</span><span style="color:#82aaff;"> https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-installer.sh </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">sh</span></pre>

  <button class="button copy-clipboard-button primary" data-copy="curl --proto '=https' --tlsv1.2 -LsSf https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-installer.sh | sh">
    <svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg>
  </button>
  
  
    
    
      
    
    <a class="button primary" href="/traefikctl/traefikctl-installer.sh.txt">Source</a>
  
</div>
                

                
              </li>
            
              
              <li data-id="11" data-triple="x86_64-unknown-linux-gnu" class="install-content hidden">
                

                
                  
                  <div class="download-wrapper">
                    <a href="https://github.com/auser/traefikctl/releases/download/v0.2.36/traefikctl-x86_64-unknown-linux-gnu.tar.xz">
                      <button class="button primary">
                        <span>Download</span>
                        <span class="button-subtitle">traefikctl-x86_64-unknown-linux-gnu.tar.xz</span>
                      </button>
                    </a>
                  </div>
                
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>

  
    <div class="no-autodetect hidden">
      <span class="no-autodetect-details">We weren't able to detect your OS.</span>
    </div>
    <noscript>
      <a href="/traefikctl/artifacts/">View all installation options</a>
    </noscript>
  
  <div class="mac-switch hidden">This project doesn't offer Apple Silicon downloads, but you can run Intel macOS binaries via Rosetta 2.</div>

  
  
  <div class="bottom-options ">
    <a href="/traefikctl/artifacts/" class="backup-download primary">View all installation options</a>
    
      <div class="arch-select hidden">
        <select id="install-arch-select">
          <option disabled="true" selected="true" value=""></option>
          
            <option value="x86_64-unknown-linux-gnu">Linux x64</option>
          
            <option value="aarch64-apple-darwin">macOS Apple Silicon</option>
          
            <option value="x86_64-apple-darwin">macOS Intel</option>
          
            <option value="x86_64-pc-windows-msvc">Windows x64</option>
          
        </select>
      </div>
    
  </div>
</div>

<a href="/traefikctl/artifacts/" class="button mobile-download primary">View all installation options</a>


    <h1>Traefik Dynamic Configuration Manager</h1>
<p>A Rust library for managing Traefik dynamic configuration through etcd.</p>
<h2>Installation</h2>
<p>Head to <a href="https://auser.github.io/traefikctl/" rel="noopener noreferrer">https://auser.github.io/traefikctl/</a> for installation instructions.</p>
<h2>Configuration</h2>
<p>The configuration is done in the <code>config/config.yml</code> file. You can also pass in a partial etcd config via the cli to override the default config.</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">traefikctl get -f ./config/config-devcontainer.yml --etcd-config='{"endpoints": ["https://0.0.0.0:2379"], "tls": {"cert": "./config/tls/etcd-peer.pem", "key": "./config/tls/etcd-peer-key.pem", "ca": "./config/tls/ca.pem", "domain": "etcd"}}'
</span></pre>

<p>The configuration file actually contains a script using the handlebars syntax (<a href="https://docs.rs/tera/latest/tera/" rel="noopener noreferrer">tera</a>) that is used to generate the configuration file, so you can use the <code>render</code> command to see what exactly is being generated before being used.</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">traefikctl render -f ./config/config-devcontainer.yml
</span></pre>

<p>There is a helper to use the environment variables to save typing <code>-f {config_file}</code>. Use <code>.envrc</code> to load the environment variables:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">source .envrc
</span><span style="color:#eeffff;"># Or 
</span><span style="color:#eeffff;">direnv allow
</span></pre>

<p><strong>YOU MUST RUN THE FOLLOWING COMMANDS OTHERWISE IT WILL NOT WORK:</strong></p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">cp .devcontainer/traefik/dynamic.example.yml .devcontainer/traefik/dynamic.yml
</span><span style="color:#eeffff;">cp .devcontainer/traefik/traefik.example.yml .devcontainer/traefik/traefik.yml
</span></pre>

<h2>Getting Started</h2>
<p>There are a few scripts to help you get started.</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;"># Build the docker image (to contain common dependencies)
</span><span style="color:#eeffff;">./scripts/devex.sh build
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;"># Start the docker container
</span><span style="color:#eeffff;">./scripts/devex.sh start
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;"># Exec into the container
</span><span style="color:#eeffff;">./scripts/devex.sh exec
</span></pre>

<h3>Reset the container</h3>
<p>Occasionally you may need to reset the container. This will remove the container, rebuild the image, and start a new one. This uses the <code>devcontainer</code> command. If you do not have the <code>devcontainer</code> command, you can open vscode and run the <code>install devcontainer</code> command using the command palette.</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">./scripts/devex.sh reset
</span></pre>

<h2>Architecture</h2>
<p>This project is built with a few goals in mind:</p>
<ul>
<li>Keep the configuration of <em>traefik</em> as simple as possible using etcd and a simple configuration format.</li>
</ul>
<p>Traefik is configured using a simple configuration format that is easy to understand and modify. The configuration is stored in etcd, and is automatically synced to the container. in addition, there is a frontend web app you can use to manage the configuration (more on that later).</p>
<p><code>traefikctl</code> is a cli tool that is used to manage the configuration. It can be executed using the <code>traefikctl</code> command or through source using <code>cargo run</code>. To see all of the commands, you can run <code>cargo run -- --help</code> or <code>traefikctl --help</code>.</p>
<p>To get started, you can run <code>traefikctl get</code> to see the current configuration, but you can generate your own config file using the <code>traefikctl generate</code> command.</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">traefikctl generate -o ./config/generated.yml
</span></pre>

<p>In the case of using the <code>devcontainer</code> command, you'll need to generate ssl certificates for the etcd server. You can use the <code>./scripts/gen-certs.sh</code> script to generate the certificates. Run the command to see all of the options.</p>
<p>After you generate the certificates, you'll need to load them into the container.</p>
<p>The helpful script <code>./scripts/devex.sh</code> can be used to launch the devcontainer, load the certificates, run etcd, traefik, and (eventually) the frontend.</p>
<h3>Hosts</h3>
<p>Each host has a domain, a list of paths, and a list of deployments.</p>
<h4>Paths</h4>
<p>Each path has a path, a list of deployments, a list of middlewares, and a boolean to strip the prefix. The deployments are keyed by the deployment name, which is used to determine which router to use.</p>
<h4>Deployments</h4>
<p>Each deployment has an ip, a port, a weight, and a boolean to determine if the cookie should be passed through.</p>
<p>It can also have a list of weights for each deployment.</p>
<p><strong>The root of the project are deployments.</strong> Every deployment will create a router in Traefik as well as a service. You can configure the deployment to handle <a href="https://doc.traefik.io/traefik" rel="noopener noreferrer">Traefik</a> routes as well as <code>Kubernetes</code> routes.</p>
<h2>Features</h2>
<ul>
<li>Strongly typed configuration using Rust structs that are automatically exported to TypeScript</li>
<li>Support for blue/green deployments with weighted load balancing</li>
<li>Middleware configuration for headers, TLS, and more</li>
<li>Host and path-based routing</li>
<li>Integration with etcd key-value store</li>
</ul>
<h2>Configuration Example</h2>
<p>The configuration is defined in YAML format. Here's an example:</p>
<pre style="background-color:#263238;"><span style="color:#f07178;">etcd</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">  </span><span style="color:#f07178;">endpoints</span><span style="color:#89ddff;">: ["</span><span style="color:#c3e88d;">https://0.0.0.0:2379</span><span style="color:#89ddff;">"]
</span><span style="color:#eeffff;">  </span><span style="color:#f07178;">timeout</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">2000
</span><span style="color:#eeffff;">  </span><span style="color:#f07178;">keep_alive</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">300
</span><span style="color:#eeffff;">  </span><span style="color:#f07178;">tls</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">    </span><span style="color:#f07178;">cert</span><span style="color:#89ddff;">: "</span><span style="color:#c3e88d;">./config/tls/etcd-peer.pem</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">    </span><span style="color:#f07178;">key</span><span style="color:#89ddff;">: "</span><span style="color:#c3e88d;">./config/tls/etcd-peer-key.pem</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">    </span><span style="color:#f07178;">ca</span><span style="color:#89ddff;">: "</span><span style="color:#c3e88d;">./config/tls/ca.pem</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">    </span><span style="color:#f07178;">domain</span><span style="color:#89ddff;">: </span><span style="color:#c3e88d;">herringbank.com
</span><span style="color:#eeffff;">
</span><span style="color:#f07178;">middlewares</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">  </span><span style="color:#f07178;">enable-headers</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">    </span><span style="color:#f07178;">headers</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">      </span><span style="color:#f07178;">custom_request_headers</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">        </span><span style="color:#f07178;">X-Forwarded-Proto</span><span style="color:#89ddff;">: "</span><span style="color:#c3e88d;">https</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">        </span><span style="color:#f07178;">X-Forwarded-Port</span><span style="color:#89ddff;">: "</span><span style="color:#c3e88d;">443</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">        </span><span style="color:#f07178;">Location</span><span style="color:#89ddff;">: ""
</span><span style="color:#eeffff;">      </span><span style="color:#f07178;">custom_response_headers</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">        </span><span style="color:#f07178;">Location</span><span style="color:#89ddff;">: ""
</span><span style="color:#eeffff;">      </span><span style="color:#f07178;">access_control_allow_methods</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">- "</span><span style="color:#c3e88d;">GET</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">      </span><span style="color:#f07178;">access_control_allow_headers</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">- "</span><span style="color:#c3e88d;">Content-Type</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">      </span><span style="color:#f07178;">access_control_expose_headers</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">- </span><span style="color:#c3e88d;">Location
</span><span style="color:#eeffff;">      </span><span style="color:#f07178;">add_vary_header</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">true
</span><span style="color:#eeffff;">
</span><span style="color:#f07178;">hosts</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">- </span><span style="color:#f07178;">domain</span><span style="color:#89ddff;">: "</span><span style="color:#c3e88d;">example.com</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">    </span><span style="color:#f07178;">www_redirect</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">true
</span><span style="color:#eeffff;">    </span><span style="color:#f07178;">paths</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">      </span><span style="color:#89ddff;">- </span><span style="color:#f07178;">path</span><span style="color:#89ddff;">: "</span><span style="color:#c3e88d;">/test</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">        </span><span style="color:#f07178;">deployments</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">          </span><span style="color:#f07178;">blue</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">            </span><span style="color:#f07178;">ip</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">10.0.0.1
</span><span style="color:#eeffff;">            </span><span style="color:#f07178;">port</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">8080
</span><span style="color:#eeffff;">            </span><span style="color:#f07178;">weight</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">50
</span><span style="color:#eeffff;">          </span><span style="color:#f07178;">green</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">            </span><span style="color:#f07178;">ip</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">10.0.0.2
</span><span style="color:#eeffff;">            </span><span style="color:#f07178;">port</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">8080
</span><span style="color:#eeffff;">            </span><span style="color:#f07178;">weight</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">50
</span><span style="color:#eeffff;">        </span><span style="color:#f07178;">middlewares</span><span style="color:#89ddff;">:  
</span><span style="color:#eeffff;">          </span><span style="color:#89ddff;">- </span><span style="color:#c3e88d;">enable-headers
</span><span style="color:#eeffff;">          </span><span style="color:#89ddff;">- </span><span style="color:#c3e88d;">forward-server
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;"># Root path (catch-all)
</span><span style="color:#eeffff;">    </span><span style="color:#f07178;">deployments</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">      </span><span style="color:#f07178;">blue</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">        </span><span style="color:#f07178;">ip</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">10.0.0.1
</span><span style="color:#eeffff;">        </span><span style="color:#f07178;">port</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">8080
</span><span style="color:#eeffff;">        </span><span style="color:#f07178;">weight</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">100
</span></pre>

<h3>Connecting to etcd</h3>
<p>You can connect to etcd using a TLS certificate, or over an ssh tunnel. The <code>endpoints</code> field in the config file should be a list of all the etcd endpoints you want to connect to. If you are connecting over tls, you will need to provide the cert, key, and ca files. as the <code>tls</code> field.</p>
<h3>Middleware Configuration</h3>
<p>Middlewares are configured in the <code>middlewares</code> section. Each middleware has a name, and a set of options that are specific to the middleware. The middleware name is the name of the middleware in Traefik. The middleware name is used to apply the middleware to a path.</p>
<h3>Host Configuration</h3>
<p>Hosts are configured in the <code>hosts</code> section. Each host has a domain, a list of paths, and a list of deployments. The domain is used to determine which router to use in Traefik. The paths are used to determine which deployments to use for the path.</p>
<p>Without <code>paths</code>, you can configure the host to catch all paths. with a root <code>deployments</code> section. If you want to configure a specific path, you can do so with the <code>paths</code> section.</p>
<h3>Keys in deployments</h3>
<ul>
<li><code>ip</code> - The ip address of the deployment</li>
<li><code>port</code> - The port of the deployment</li>
<li><code>weight</code> - The weight of the deployment</li>
<li><code>protocol</code> - The protocol to use to connect to the deployment. Defaults to <code>http</code> but you can set it to <code>tls</code>.</li>
</ul>
<h2>Running over an ssh tunnel</h2>
<pre style="background-color:#263238;"><span style="color:#eeffff;">ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -L 2379:0.0.0.0:2379 alerner@proxy
</span></pre>

<h2>Frontend</h2>
<p>The frontend is a simple web app that is used to manage the configuration. It is built with <a href="https://svelte.dev/" rel="noopener noreferrer">Svelte</a> and <a href="http://getskeleton.com/" rel="noopener noreferrer">Skeleton</a>.</p>
<p>It is not built with any frameworks in mind, so it could be hosted on any static file server.</p>
<p>There is a helpful command to start the frontend  -- <code>cargo make dev</code>.</p>
<blockquote>
<p>If you get an error on a mac, you'll need to reinstall the <code>cargo-make</code> crate.
Cannot run macOS (Mach-O) executable in Docker: Exec format error</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">cargo install cargo-make --force
</span><span style="color:#eeffff;">cargo install cargo-watch --force
</span></pre>

</blockquote>
<h2>Dev notes</h2>
<p>Check the etcd container for keys:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;"># Find the etcd container ID
</span><span style="color:#eeffff;">docker ps --format '{{.ID}} {{.Image}} {{.Names}}' | awk '($2 ~ /docker.io\/bitnami\/etcd/ || $3 ~ /etcd$/) {print $1}'
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;"># Or as a one-liner:
</span><span style="color:#eeffff;">ETCD_ID=$(docker ps --format '{{.ID}} {{.Image}} {{.Names}}' | awk '($3 ~ /etcd/) {print $1}')
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;"># Then use it like:
</span><span style="color:#eeffff;">docker exec -it $ETCD_ID etcdctl get /traefik/config --prefix
</span><span style="color:#eeffff;"># Or as a one-liner:
</span><span style="color:#eeffff;">docker exec -it $(docker ps --format '{{.ID}} {{.Image}} {{.Names}}' | awk '($3 ~ /etcd/) {print $1}') bash
</span><span style="color:#eeffff;">export ecd="/opt/bitnami/etcd/bin/etcdctl --endpoints=https://localhost:2379 --cacert=/etc/etcd/tls/ca.pem --cert=/etc/etcd/tls/server.pem --key=/etc/etcd/tls/server-key.pem"
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;"># traefik container
</span><span style="color:#eeffff;">docker exec -it $(docker ps --format '{{.ID}} {{.Image}} {{.Names}}' | awk '($3 ~ /-traefik/) {print $1}') sh
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">export ecd="/bin/etcdctl --endpoints=https://etcd:2379 --cacert=/etc/traefik/tls/ca.pem --cert=/etc/traefik/tls/server.pem --key=/etc/traefik/tls/server-key.pem"
</span></pre>

<h2>Graphviz</h2>
<p>In case the visualization isn't helpful within yaml, you can turn it into a dot graph using graphviz</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">sudo apt update &amp;&amp; sudo apt install graphviz
</span></pre>

<p>Then you can run the following command to generate a graph into pdf:</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">cargo run -- graph -d &gt; public/graph.dot &amp;&amp; dot -T pdf public/graph.dot -o public/graph.pdf
</span></pre>

<h2>WINDOWS</h2>
<p>Okay, to get this working on windows, you'll need to make sure <a href="https://docs.docker.com/desktop/install/windows-install/" rel="noopener noreferrer">Docker Desktop</a> is installed and running <em>and</em> connected to the WSL 2 backend. You'll also need to make sure you have the <code>devcontainer</code> command installed. You can install it using VSCode.</p>
<p>Press <code>Ctrl+Shift+P</code> and search for <code>install devcontainer</code> and run the command.</p>
<p>This does <strong>not</strong> work with powershell, you must use <a href="https://docs.microsoft.com/en-us/windows/wsl/install" rel="noopener noreferrer">wsl</a> to run the commands.</p>



        </main>
      </div>

      <footer>
        
          <a href="https://github.com/auser/traefikctl"><div class="github-icon" aria-hidden="true"></div></a>
        
        <span>
          traefikctl, MIT OR Apache-2.0
        </span>
      </footer>
    </div>

    
    

    

    <script src="/traefikctl/artifacts.js"></script>


  </body>
</html>